function EventStream() { this.initialized = false; this.connect = function () { if (!this.initialized) { var a = $.connection.eventStream; var b = this; a.receiveEvent = function (a) { var c = $.parseJSON(a); var d = $("#eventStream-template-" + c.Type); if (d && d.tmpl) { b.eventReceived(c, d.tmpl(c.Type == "event" ? c : c.Event)) } else { b.eventReceived(c) } }; $.connection.hub.start({}, function () { a.authorize().fail(function (a) { $.connection.hub.stop(); b.connectionFailed(a) }).done(function (a) { if (a === false) { $.connection.hub.stop(); b.unauthorized() } }) }); this.initialized = true } return this }; this.eventReceived = function (a, b) { $("body").append(b) }; this.connectionFailed = function (a) { alert("unable to connect to event stream.\r\nError:" + a) }; this.unauthorized = function (a) { } }